{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "role drift schema v1",
  "type": "object",
  "required": [
    "role_drift_schema_version",
    "run_id",
    "candidate_id",
    "generated_at_utc",
    "source_artifact",
    "windows"
  ],
  "properties": {
    "role_drift_schema_version": {
      "type": "integer",
      "enum": [
        1
      ]
    },
    "run_id": {
      "type": "string"
    },
    "candidate_id": {
      "type": "string"
    },
    "generated_at_utc": {
      "type": "string"
    },
    "source_artifact": {
      "$ref": "#/$defs/file_pointer"
    },
    "windows": {
      "type": "object",
      "required": [
        "last_7_days",
        "last_14_days",
        "last_30_days"
      ],
      "properties": {
        "last_7_days": {
          "$ref": "#/$defs/drift_window"
        },
        "last_14_days": {
          "$ref": "#/$defs/drift_window"
        },
        "last_30_days": {
          "$ref": "#/$defs/drift_window"
        }
      },
      "additionalProperties": false
    }
  },
  "$defs": {
    "file_pointer": {
      "type": "object",
      "required": [
        "path",
        "sha256",
        "bytes"
      ],
      "properties": {
        "path": {
          "type": [
            "string",
            "null"
          ]
        },
        "sha256": {
          "type": [
            "string",
            "null"
          ]
        },
        "bytes": {
          "type": [
            "integer",
            "null"
          ]
        }
      },
      "additionalProperties": false
    },
    "token_count": {
      "type": "object",
      "required": [
        "token",
        "count"
      ],
      "properties": {
        "token": {
          "type": "string"
        },
        "count": {
          "type": "integer",
          "minimum": 1
        }
      },
      "additionalProperties": false
    },
    "company_drift": {
      "type": "object",
      "required": [
        "company_key",
        "company",
        "provider_id",
        "job_count",
        "change_event_count",
        "skills_rising",
        "skills_falling",
        "seniority_shift_count",
        "location_shift_count",
        "seniority_shift_roles",
        "location_shift_roles"
      ],
      "properties": {
        "company_key": {
          "type": "string"
        },
        "company": {
          "type": [
            "string",
            "null"
          ]
        },
        "provider_id": {
          "type": [
            "string",
            "null"
          ]
        },
        "job_count": {
          "type": "integer",
          "minimum": 0
        },
        "change_event_count": {
          "type": "integer",
          "minimum": 0
        },
        "skills_rising": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/token_count"
          }
        },
        "skills_falling": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/token_count"
          }
        },
        "seniority_shift_count": {
          "type": "integer",
          "minimum": 0
        },
        "location_shift_count": {
          "type": "integer",
          "minimum": 0
        },
        "seniority_shift_roles": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "location_shift_roles": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "additionalProperties": false
    },
    "drift_window": {
      "type": "object",
      "required": [
        "window_days",
        "window_start_utc",
        "window_end_utc",
        "companies"
      ],
      "properties": {
        "window_days": {
          "type": "integer",
          "minimum": 1
        },
        "window_start_utc": {
          "type": "string"
        },
        "window_end_utc": {
          "type": "string"
        },
        "companies": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/company_drift"
          }
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}
