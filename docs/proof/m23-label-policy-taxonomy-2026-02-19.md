# M23 Provenance Label Taxonomy + Policy Receipt (2026-02-19)

## Objective
Establish and enforce PR provenance labels so Composer, Codex, and human-origin changes are distinguishable and less error-prone.

## Taxonomy Adopted
- `from-composer`: PRs generated by Composer workflow/tooling
- `from-codex`: PRs authored/executed directly by Codex
- `docs-only`: docs-only PRs (no runtime behavior changes)
- `milestone:Mxx`: milestone label family placeholder (use concrete labels such as `milestone:M23`)

## Label Inventory + Updates
Commands run:
```bash
gh label list --limit 200
gh label create from-composer --color 0E8A16 --description "PRs generated by Composer workflow/tooling" --force
gh label create from-codex --color 1D76DB --description "PRs authored/executed directly by Codex"
gh label create docs-only --color 5319E7 --description "Docs-only changes with no runtime behavior changes"
gh label create milestone:Mxx --color FBCA04 --description "Milestone tracking label family (use as milestone:M12, milestone:M23, etc.)"
gh label list --limit 200
```

Resulting relevant labels:
- `from-composer` `#0E8A16` — PRs generated by Composer workflow/tooling
- `from-codex` `#1D76DB` — PRs authored/executed directly by Codex
- `docs-only` `#5319E7` — Docs-only changes with no runtime behavior changes
- `milestone:Mxx` `#FBCA04` — Milestone tracking label family

## Stop-the-Bleeding Audit
Command run:
```bash
rg -n "from-composer|--label from-composer" .
```

Findings:
- Composer-specific queue tooling intentionally uses `from-composer`:
  - `scripts/dev/list_from_composer_prs.sh`
  - `scripts/dev/generate_codex_review_queue.sh`
- Composer audit proof docs reference `from-composer` as intended for that queue.
- No generic PR creation snippets in repo were found with hardcoded `--label from-composer`.

Action taken:
- Updated composer audit playbook to explicitly scope `from-composer` to composer-only flows and call out `from-codex` for Codex-origin PRs.

## Enforcement Added (Warning-Only)
### Script
- `scripts/check_pr_label_policy.py`

Rules implemented:
- `composer/*` branch => require `from-composer`
- `codex/*` branch => require `from-codex`
- Other prefixes => no provenance label required
- Optional `--strict` mode returns non-zero on violations (not enabled in CI yet)

### CI Wiring
- Added to PR `fast` job in `.github/workflows/ci.yml`:
```bash
python scripts/check_pr_label_policy.py --event-path "$GITHUB_EVENT_PATH" --head-ref "${{ github.head_ref }}"
```

Behavior:
- Warning-only by default (prints actionable guidance, exits 0)

## Tests
Added:
- `tests/test_check_pr_label_policy.py`

Coverage:
- branch prefix -> required label mapping
- label extraction from PR payload
- mismatch detection and wrong-provenance detection
- success path for codex branch + from-codex label

## Determinism / Safety Notes
- Policy check is local event-payload parsing only; no network/API calls required.
- Warning-only mode avoids accidental CI breakage during rollout.
- Optional `--strict` enables future promotion to blocking enforcement.
